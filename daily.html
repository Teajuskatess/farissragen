<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Form Rutinan Faris</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-blue-50 min-h-screen flex items-center justify-center">

<!-- LOGIN PAGE -->
<div id="loginPage" class="w-full max-w-sm bg-white p-6 rounded-2xl shadow-md">
  <h2 class="text-2xl font-bold text-center text-blue-700 mb-4">Login Disini</h2>
  <input id="loginName" type="text" placeholder="Masukkan Nama Lengkap" class="w-full p-2 border rounded mb-3 focus:outline-blue-500">
  <button onclick="login()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded transition-all">Masuk</button>
</div>

<!-- MAIN FORM PAGE -->
<div id="mainPage" class="hidden w-full max-w-md bg-white p-6 rounded-2xl shadow-lg relative">
  <h2 class="text-2xl font-bold text-center text-blue-700 mb-4">Daily Routine Faris</h2>
  
  <!-- GREETING -->
  <div class="mb-4 text-left">
    <p id="greeting" class="text-lg font-semibold text-gray-700"></p>
    <p class="text-sm text-gray-500">Harap isi sesuai dengan yang kamu lakukan hari ini.</p>
  </div>

  <div class="mb-3 flex items-center justify-between">
    <div class="flex-1 mr-2">
      <label class="block text-sm font-semibold">Nama Lengkap:</label>
      <input id="userName" readonly class="w-full p-2 border rounded bg-gray-100">
    </div>
    <button id="logoutBtn" onclick="confirmLogout()" class="mt-5 p-2 rounded hover:bg-gray-200 text-gray-500" title="Logout">
      <i data-lucide="log-out" class="w-5 h-5"></i>
    </button>
  </div>

  <div class="mb-3">
    <label class="block text-sm font-semibold mb-1">Sholat Wajib Yang Kamu Lakukan:</label>
    <div id="sholatButtons" class="grid grid-cols-3 gap-2">
      <button class="btn-sholat" data-value="Subuh">Subuh</button>
      <button class="btn-sholat" data-value="Dzuhur">Dzuhur</button>
      <button class="btn-sholat" data-value="Ashar">Ashar</button>
      <button class="btn-sholat" data-value="Maghrib">Maghrib</button>
      <button class="btn-sholat" data-value="Isya">Isya</button>
    </div>
  </div>

  <div class="mb-3">
    <label class="block text-sm font-semibold">Hafalan / Murojaah Yang kamu Lakukan:</label>
    <input type="checkbox" id="hafalanCheck" class="mr-2"> Sudah Melakukan
    <div id="hafalanInput" class="hidden mt-2">
      <label class="text-sm">Jumlah Juz:</label>
      <input id="juzInput" type="number" min="0" class="w-full p-2 border rounded">
    </div>
  </div>

  <div class="grid grid-cols-3 gap-2 mb-3">
    <div>
      <label class="block text-sm font-semibold">Tahajud</label>
      <input id="tahajud" type="number" class="w-full p-2 border rounded" placeholder="rakaat">
    </div>
    <div>
      <label class="block text-sm font-semibold">Dhuha</label>
      <input id="dhuha" type="number" class="w-full p-2 border rounded" placeholder="rakaat">
    </div>
    <div>
      <label class="block text-sm font-semibold">Rawatib</label>
      <input id="rawatib" type="number" class="w-full p-2 border rounded" placeholder="rakaat">
    </div>
  </div>

  <div class="flex gap-2">
    <button onclick="saveData()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded transition-all">Simpan</button>
    <button onclick="clearData()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-black py-2 rounded transition-all">Kosongkan</button>
  </div>
</div>

<!-- POPUP -->
<div id="popup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-6 rounded-2xl shadow-xl text-center">
    <h3 class="text-xl font-semibold text-blue-700 mb-2">Terima kasih!</h3>
    <p>Data Daily Routine kamu sudah tersimpan üôè</p>
    <button onclick="closePopup()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Tutup</button>
  </div>
</div>

<!-- LOGOUT CONFIRMATION -->
<div id="logoutConfirm" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-6 rounded-2xl shadow-xl text-center">
    <h3 class="text-lg font-semibold text-gray-700 mb-3">Yakin ingin logout?</h3>
    <div class="flex justify-center gap-3">
      <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">Ya</button>
      <button onclick="closeLogoutConfirm()" class="bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded">Batal</button>
    </div>
  </div>
</div>

<!-- LOADING -->
<div id="loadingOverlay" class="hidden fixed inset-0 bg-white flex flex-col items-center justify-center z-50">
  <div class="text-blue-700 text-xl font-semibold mb-2">Memuat Website...</div>
  <div class="loader-bar w-40 h-2 bg-blue-100 rounded-full overflow-hidden">
    <div class="progress h-full bg-blue-600 rounded-full"></div>
  </div>
</div>

<script>
const { jsPDF } = window.jspdf;
lucide.createIcons();

// Tombol sholat toggle + efek klik
document.querySelectorAll('.btn-sholat').forEach(btn => {
  btn.classList.add('bg-gray-100', 'p-2', 'rounded', 'text-sm', 'cursor-pointer', 'transition-all');
  btn.addEventListener('click', () => {
    btn.classList.toggle('bg-blue-200');
    btn.classList.toggle('text-blue-900');
  });
});

// Hafalan fade-in
document.getElementById('hafalanCheck').addEventListener('change', e => {
  const input = document.getElementById('hafalanInput');
  if (e.target.checked) {
    input.classList.remove('hidden');
    input.classList.add('animate-fadeIn');
  } else {
    input.classList.add('hidden');
  }
});

// Login
function login() {
  const name = document.getElementById('loginName').value.trim();
  if (!name) return alert('Masukkan nama terlebih dahulu');
  showLoading('Memuat Dashboard...');
  setTimeout(() => {
    localStorage.setItem('rohisUser', name);
    document.getElementById('userName').value = name;
    document.getElementById('loginPage').classList.add('hidden');
    document.getElementById('mainPage').classList.remove('hidden');
    document.getElementById('greeting').textContent = `Assalamu'alaikum, ${name}!`;
    loadData();
    hideLoading();
  }, 1500);
}

// Logout confirm
function confirmLogout() {
  document.getElementById('logoutConfirm').classList.remove('hidden');
}
function closeLogoutConfirm() {
  document.getElementById('logoutConfirm').classList.add('hidden');
}

// Logout with loading
function logout() {
  closeLogoutConfirm();
  showLoading('Keluar dari akun...');
  setTimeout(() => {
    localStorage.removeItem('rohisUser');
    document.getElementById('mainPage').classList.add('hidden');
    document.getElementById('loginPage').classList.remove('hidden');
    hideLoading();
  }, 1500);
}

// Popup
function showPopup() {
  document.getElementById('popup').classList.remove('hidden');
}
function closePopup() {
  document.getElementById('popup').classList.add('hidden');
}

// Simpan data
function saveData() {
  showLoading('Menyimpan data...');
  setTimeout(() => {
    const name = localStorage.getItem('rohisUser') || 'Tanpa Nama';
    const date = new Date().toLocaleDateString('id-ID');
    const selectedSholat = Array.from(document.querySelectorAll('.btn-sholat.bg-blue-200')).map(b => b.dataset.value);
    const hafalan = document.getElementById('hafalanCheck').checked ? (document.getElementById('juzInput').value || 0) : 0;
    const tahajud = document.getElementById('tahajud').value || 0;
    const dhuha = document.getElementById('dhuha').value || 0;
    const rawatib = document.getElementById('rawatib').value || 0;

    let data = JSON.parse(localStorage.getItem('rohisData') || '[]');
    const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
    data = data.filter(d => new Date(d.timestamp).getTime() > weekAgo);

    data.push({
      name, date, sholat: selectedSholat.join(', '), hafalan, tahajud, dhuha, rawatib,
      timestamp: new Date().toISOString()
    });
    localStorage.setItem('rohisData', JSON.stringify(data));

    generatePDF(data, name);
    hideLoading();
    showPopup();
  }, 1500);
}

// Generate PDF
function generatePDF(data, name) {
  const doc = new jsPDF();
  doc.setFontSize(14);
  doc.text(`Nama: ${name}`, 10, 15);
  const startY = 25;
  const headers = ["Tanggal", "Sholat 5 Waktu", "Hafalan (Juz)", "Tahajud", "Dhuha", "Rawatib"];
  const colWidths = [25, 60, 25, 20, 20, 25];
  let y = startY;
  let x = 10;
  doc.setFontSize(10);
  headers.forEach((h, i) => { doc.text(h, x, y); x += colWidths[i]; });
  y += 6;
  doc.line(10, y - 4, 190, y - 4);
  data.forEach(row => {
    x = 10;
    const vals = [row.date, row.sholat, String(row.hafalan), String(row.tahajud), String(row.dhuha), String(row.rawatib)];
    vals.forEach((v, i) => {
      doc.text(v, x, y);
      x += colWidths[i];
    });
    y += 6;
  });
  doc.save(`DailyRoutine_${name}_${new Date().toLocaleDateString('id-ID')}.pdf`);
}

// Kosongkan form
function clearData() {
  document.querySelectorAll('.btn-sholat').forEach(b => b.classList.remove('bg-blue-200'));
  document.getElementById('hafalanCheck').checked = false;
  document.getElementById('hafalanInput').classList.add('hidden');
  document.getElementById('juzInput').value = '';
  document.getElementById('tahajud').value = '';
  document.getElementById('dhuha').value = '';
  document.getElementById('rawatib').value = '';
}

// Load data saat login
function loadData() {
  const data = JSON.parse(localStorage.getItem('rohisData') || '[]');
  const name = localStorage.getItem('rohisUser');
  if (name) {
    document.getElementById('userName').value = name;
    document.getElementById('greeting').textContent = `Assalamu'alaikum, ${name}!`;
  }
}

// Loading overlay control
function showLoading(text) {
  const overlay = document.getElementById('loadingOverlay');
  overlay.querySelector('.text-blue-700').textContent = text;
  overlay.classList.remove('hidden');
  const bar = overlay.querySelector('.progress');
  bar.style.width = '0%';
  setTimeout(() => bar.style.width = '100%', 50);
}
function hideLoading() {
  const overlay = document.getElementById('loadingOverlay');
  setTimeout(() => overlay.classList.add('hidden'), 700);
}

// Saat halaman dibuka
window.addEventListener('load', () => {
  showLoading('Memuat Website...');
  setTimeout(hideLoading, 1200);
});
</script>

<style>
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.animate-fadeIn { animation: fadeIn 0.5s ease-in; }

/* --- Efek Hover dan Klik pada Tombol Sholat --- */
.btn-sholat {
  transition: all 0.25s ease;
  border: 1px solid transparent;
  position: relative;
  overflow: hidden;
}
.btn-sholat:hover {
  background-color: #bfdbfe;
  border-color: #3b82f6;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(59, 130, 246, 0.2);
}
.btn-sholat.bg-blue-200 {
  background-color: #bfdbfe;
  border-color: #2563eb;
  color: #1e3a8a;
  font-weight: 600;
  box-shadow: inset 0 0 6px rgba(37, 99, 235, 0.4);
}
.btn-sholat:active {
  transform: scale(0.97);
  box-shadow: 0 2px 4px rgba(37, 99, 235, 0.3);
}

/* --- Loading Progress Bar --- */
.loader-bar .progress {
  width: 0%;
  transition: width 1.2s ease;
}
</style>
</body>
</html>
